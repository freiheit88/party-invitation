
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sean‚Äôs Party Invitation ¬∑ tuned in A</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Manrope:wght@300;400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg: #05070a;
      --accent: #f5e6b8;
      --accent-soft: #f2e4c0;
      --highlight: #fbd88f;
      --text-main: #f8f7f4;
      --text-soft: #a7a5a0;
      --button-bg: #202331;
      --button-border: rgba(245, 230, 184, 0.7);
      --glow: rgba(245, 230, 184, 0.45);
      --placeholder-border: rgba(248, 247, 244, 0.25);
      --placeholder-bg: rgba(5, 7, 10, 0.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Manrope", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: #000 url("picture/AlteOper.png") center/cover no-repeat fixed;
      color: var(--text-main);
      min-height: 100vh;
      overflow: hidden;
    }

    .hidden {
      display: none !important;
    }

    /* ===== Í≥µÌÜµ: Ï†ÑÏ≤¥ ÌôîÎ©¥ Ïä§ÌÅ¨Î¶∞ ÎûòÌçº ===== */
    .screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      z-index: 1;
    }

    /* ===== -1Ïû•: Pre-intro (ÏòÅÏÉÅ + Î∏åÎü¨Ïãú ÌåùÏóÖ) ===== */
    .preintro-screen {
      z-index: 30;
    }

    .preintro-video-wrap {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 480px;
      border-radius: 18px;
      overflow: hidden;
      background: #000;
    }

    .preintro-video-wrap video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preintro-dark {
      position: absolute;
      inset: 0;
      background: radial-gradient(
          circle at top,
          rgba(0, 0, 0, 0.25),
          rgba(0, 0, 0, 0.85)
        ),
        linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.75),
          rgba(0, 0, 0, 0.98)
        );
      transition: opacity 1.2s ease;
      pointer-events: none;
    }

    .preintro-touch-layer {
      position: absolute;
      inset: 0;
      cursor: pointer;
      z-index: 3;
    }

    /* -1Ïû•: Î®∏Î¶¨Ïπ¥ÎùΩ ÎäêÎÇå */
    .preintro-hair {
      position: absolute;
      top: -40px;
      left: -5%;
      width: 110%;
      height: 140px;
      background:
        radial-gradient(circle at 12% 10%, rgba(0,0,0,0.95) 0, transparent 55%) 0 0 / 40% 100% no-repeat,
        radial-gradient(circle at 45% 0%, rgba(0,0,0,0.98) 0, transparent 60%) 30% 0 / 38% 100% no-repeat,
        radial-gradient(circle at 82% 12%, rgba(0,0,0,0.9) 0, transparent 60%) 75% 0 / 42% 100% no-repeat;
      opacity: 0.95;
      pointer-events: none;
      z-index: 2;
    }

    /* -1Ïû•: Î∏åÎü¨Ïãú ÌåùÏóÖ */
    .preintro-popup-wrap {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 4;
      pointer-events: none;
    }

    .preintro-popup {
      pointer-events: auto;
      min-width: 220px;
      max-width: 280px;
      padding: 14px 16px;
      border-radius: 18px;
      background: radial-gradient(
          circle at top left,
          rgba(245, 230, 184, 0.18),
          rgba(10, 10, 12, 0.95)
        ),
        rgba(8, 8, 10, 0.98);
      border: 1px solid rgba(245, 230, 184, 0.6);
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.8);
      text-align: center;
      animation: popup-in 0.4s ease;
    }

    .preintro-popup-title {
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent-soft);
      margin-bottom: 6px;
    }

    .preintro-popup-body {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.6;
    }

    .preintro-popup-body strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    .preintro-popup-hint {
      font-size: 10px;
      color: rgba(167, 165, 160, 0.9);
      margin-top: 8px;
    }

    .preintro-popup-fade-out {
      animation: popup-out 0.45s ease forwards;
    }

    @keyframes popup-in {
      from {
        opacity: 0;
        transform: translateY(8px) scale(0.96);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes popup-out {
      to {
        opacity: 0;
        transform: translateY(-4px) scale(0.97);
      }
    }

    .preintro-fade-out {
      animation: preintro-fade 0.6s ease forwards;
    }

    @keyframes preintro-fade {
      to {
        opacity: 0;
        transform: scale(1.02);
      }
    }

    /* ===== 0Ïû•: Prelude (Ìó§ÎìúÌè∞ ÏïàÎÇ¥) ===== */
    .prelude-screen {
      z-index: 20;
      background: radial-gradient(
          circle at top,
          rgba(15, 18, 30, 0.96) 0,
          rgba(5, 7, 10, 0.98) 55%
        );
    }

    .pre-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      gap: 22px;
      padding: 18px;
      max-width: 480px;
      animation: screen-fade-in 0.4s ease;
    }

    @keyframes screen-fade-in {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pre-title {
      font-family: "Playfair Display", serif;
      font-size: 22px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-soft);
    }

    .pre-sub {
      font-size: 13px;
      color: var(--text-soft);
      max-width: 320px;
      line-height: 1.7;
    }

    .pre-sub strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    .pre-visual {
      width: 210px;
      height: 210px;
      border-radius: 999px;
      border: 1px solid rgba(245, 230, 184, 0.5);
      background: radial-gradient(
          circle at top,
          rgba(245, 230, 184, 0.45) 0,
          rgba(5, 7, 10, 0.9) 55%
        ),
        rgba(5, 7, 10, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.65);
    }

    .pre-wave-ring {
      position: absolute;
      width: 85%;
      height: 85%;
      border-radius: 999px;
      border: 1px dashed rgba(245, 230, 184, 0.35);
      opacity: 0.5;
    }

    .pre-wave-ring.second {
      width: 65%;
      height: 65%;
      opacity: 0.7;
    }

    .pre-icon-card {
      width: 80px;
      height: 120px;
      border-radius: 18px;
      background: linear-gradient(
        145deg,
        rgba(15, 18, 30, 0.95),
        rgba(40, 42, 64, 0.95)
      );
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .pre-icon-phone {
      width: 28px;
      height: 44px;
      border-radius: 10px;
      border: 1px solid rgba(245, 230, 184, 0.45);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .pre-icon-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-soft);
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.9;
    }

    .pre-icon-speaker {
      width: 13px;
      height: 13px;
      border-radius: 4px;
      border: 1px solid rgba(245, 230, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--accent-soft);
    }

    .pre-icon-waves {
      position: absolute;
      right: -16px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .pre-wave-line {
      width: 12px;
      height: 2px;
      border-radius: 999px;
      background: rgba(245, 230, 184, 0.8);
      opacity: 0.9;
    }

    .pre-label {
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(245, 230, 184, 0.9);
    }

    .pre-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .pre-btn-main {
      padding: 11px 24px;
      border-radius: 999px;
      border: 1px solid var(--button-border);
      background: radial-gradient(
        circle at top left,
        #262a3f 0,
        var(--button-bg) 60%
      );
      color: var(--text-main);
      font-size: 12px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .pre-btn-main::after {
      content: "";
      position: absolute;
      top: 0;
      left: -40%;
      width: 40%;
      height: 100%;
      background: linear-gradient(
        120deg,
        rgba(245, 230, 184, 0.35),
        transparent
      );
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }

    .pre-btn-main:hover::after {
      transform: translateX(180%);
    }

    .pre-btn-ghost {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 11px;
      cursor: pointer;
      opacity: 0.7;
    }

    .pre-caption-small {
      font-size: 10px;
      color: #8f8a7e;
      max-width: 320px;
      line-height: 1.5;
    }

    /* ===== 1Ïû•: Î©îÏù∏ Ïï± ===== */
    .main-screen {
      z-index: 10;
      background: transparent;
    }

    .app {
      position: relative;
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      padding: 18px 18px 30px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: radial-gradient(
          circle at top,
          rgba(15, 18, 30, 0.96) 0,
          rgba(5, 7, 10, 0.97) 55%
        );
      backdrop-filter: blur(4px);
      animation: screen-fade-in 0.4s ease;
    }

    /* Î®∏Î¶¨Ïπ¥ÎùΩ Ïò§Î≤ÑÎ†àÏù¥ (Î©îÏù∏ ÌôîÎ©¥) */
    .hair-overlay {
      pointer-events: auto;
      position: absolute;
      top: -40px;
      left: 0;
      width: 110%;
      height: 120px;
      background: radial-gradient(
            circle at 10% 10%,
            rgba(0, 0, 0, 0.9) 0,
            transparent 55%
          )
          0 0 / 45% 100% no-repeat,
        radial-gradient(
            circle at 40% 0%,
            rgba(0, 0, 0, 0.95) 0,
            transparent 60%
          )
          40% 0 / 35% 100% no-repeat,
        radial-gradient(
            circle at 80% 10%,
            rgba(0, 0, 0, 0.9) 0,
            transparent 60%
          )
          80% 0 / 40% 100% no-repeat;
      opacity: 0.75;
      z-index: 5;
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .hair-overlay.hair-gone {
      opacity: 0;
      transform: translateY(-40px);
      pointer-events: none;
    }

    /* ÌÉ≠ */
    .tabs {
      position: relative;
      z-index: 2;
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      background: rgba(5, 7, 10, 0.7);
      border-radius: 999px;
      padding: 4px;
    }

    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      background: transparent;
      color: var(--text-soft);
      transition:
        background 0.2s ease,
        color 0.2s ease;
    }

    .tab-btn.active {
      background: rgba(32, 35, 49, 0.9);
      color: var(--accent-soft);
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 1;
    }

    .tab-panel {
      display: none;
      flex: 1;
      flex-direction: column;
      gap: 20px;
      margin-top: 8px;
    }

    .tab-panel.active {
      display: flex;
    }

    /* Í≥µÌÜµ ÌÖçÏä§Ìä∏ */
    .title {
      font-family: "Playfair Display", serif;
      font-size: 25px;
      line-height: 1.3;
      letter-spacing: 0.02em;
    }

    .title span.accent {
      color: var(--accent);
      letter-spacing: 0.16em;
      font-size: 11px;
      text-transform: uppercase;
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .highlight-word {
      color: var(--highlight);
      font-weight: 700;
    }

    .highlight-letter {
      color: var(--accent-soft);
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-size: 13px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.7;
      max-width: 360px;
      margin-top: 10px;
    }

    .subtitle strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    /* Invitation tab ¬∑ text slider (Î≥∏Î¨∏) */
    .invitation-slider {
      margin-top: 12px;
    }

    .inv-slide {
      display: none;
    }

    .inv-slide.active {
      display: block;
    }

    .inv-pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
    }

    .inv-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      border: none;
      padding: 0;
      background: rgba(255, 255, 255, 0.18);
      opacity: 0.5;
      cursor: pointer;
      transition:
        opacity 0.25s ease,
        transform 0.15s ease,
        background 0.25s ease;
    }

    .inv-dot.active {
      background: var(--accent-soft);
      opacity: 1;
      transform: scale(1.15);
    }

    .inv-dot:focus-visible {
      outline: 1px solid rgba(245, 230, 184, 0.7);
      outline-offset: 2px;
    }

    /* Hero Ïù¥ÎØ∏ÏßÄ Î∞ïÏä§ + AppleÏãù Ï∫°ÏÖò Ïä¨ÎùºÏù¥Îìú */
    .hero-image-box {
      margin-top: 10px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: #000;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.55);
    }

    .hero-image-box img {
      display: block;
      width: 100%;
      height: 140px;
      object-fit: cover;
      filter: saturate(1.08) contrast(1.08);
    }

    .hero-caption {
      position: relative;
      min-height: 70px;
      padding: 6px 10px 8px;
      font-size: 11px;
      color: var(--text-soft);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      overflow: hidden;
    }

    .hero-caption-slide {
      position: absolute;
      inset: 6px 10px 18px;
      opacity: 0;
      transform: translateX(8px);
      transition:
        opacity 0.5s ease,
        transform 0.5s ease;
    }

    .hero-caption-slide.active {
      opacity: 1;
      transform: translateX(0);
    }

    .hero-caption-primary {
      font-size: 11px;
      margin-bottom: 4px;
      color: var(--accent-soft);
      font-weight: 600;
    }

    .hero-caption-body {
      font-size: 11px;
      text-transform: none;
      letter-spacing: 0.02em;
      line-height: 1.5;
    }

    .hero-caption-meta {
      margin-top: 4px;
      font-size: 10px;
      opacity: 0.9;
    }

    .hero-caption-dots {
      position: absolute;
      right: 10px;
      bottom: 4px;
      display: flex;
      gap: 4px;
    }

    .hero-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.25);
    }

    .hero-dot.active {
      background: var(--accent-soft);
    }

    /* ÏãúÍ∞Ñ/Ïû•ÏÜå Ïπ¥Îìú */
    .time-location-card {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(245, 230, 184, 0.45);
      background: radial-gradient(
        circle at top left,
        rgba(245, 230, 184, 0.18) 0,
        rgba(10, 12, 18, 0.9) 60%
      );
      padding: 10px 12px;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.55);
    }

    .datetime {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .datetime span {
      display: block;
    }

    .datetime span:first-child {
      font-weight: 600;
      color: #e2ddcf;
    }

    .info-strip {
      margin-top: 6px;
      font-size: 12px;
      color: var(--text-soft);
      opacity: 0.95;
    }

    .info-strip span {
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 11px;
    }

    /* TUNE ÏÑπÏÖò */
    .tune-section {
      margin-top: 10px;
    }

    .tune-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }

    .tune-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #d2cdbf;
      opacity: 0.8;
    }

    .instrument-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(245, 230, 184, 0.5);
      color: var(--accent-soft);
      background: rgba(15, 18, 30, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .instrument-pill-label {
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .instrument-name {
      font-size: 11px;
      font-weight: 600;
    }

    .tune-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
      margin-top: 2px;
    }

    /* ÏùåÏïÖ ON/OFF Ï∫°Ïäê */
    .music-pill {
      position: relative;
      width: 140px;
      padding: 6px 10px 8px;
      border-radius: 999px;
      border: 1px solid rgba(245, 230, 184, 0.6);
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
      background: rgba(10, 12, 18, 0.7);
      opacity: 0.9;
      transition:
        background 0.25s ease,
        box-shadow 0.25s ease,
        opacity 0.25s ease,
        transform 0.15s ease;
      overflow: hidden;
    }

    /* Í∞ÄÎ°úÎì± Î∞±Í∏ÄÎ°úÏö∞ (OFF ÏÉÅÌÉúÏóêÏÑú) */
    .music-pill::before {
      content: "";
      position: absolute;
      inset: -10px -20px;
      border-radius: 999px;
      background: radial-gradient(
        circle at 10% -20%,
        rgba(245, 230, 184, 0.45),
        transparent 65%
      );
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease;
      z-index: -1;
    }

    .music-pill.music-off::before {
      opacity: 0.7;
    }

    .music-pill:active {
      transform: scale(0.96);
    }

    .music-pill-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .music-icon {
      font-size: 14px;
      line-height: 1;
    }

    .music-meter {
      display: flex;
      gap: 2px;
      align-items: flex-end;
    }

    .music-bar {
      width: 3px;
      border-radius: 999px;
      background: rgba(240, 230, 190, 0.7);
      transition:
        height 0.25s ease,
        opacity 0.25s ease,
        background 0.25s ease;
    }

    .music-pill.music-on {
      background: radial-gradient(
        circle at top,
        rgba(245, 230, 184, 0.4) 0,
        rgba(10, 12, 18, 0.85) 70%
      );
      box-shadow: 0 0 14px var(--glow);
      opacity: 1;
      animation: music-glow 4s ease-in-out infinite;
    }

    @keyframes music-glow {
      0%, 100% {
        box-shadow: 0 0 14px rgba(245, 230, 184, 0.65);
      }
      50% {
        box-shadow: 0 0 6px rgba(245, 230, 184, 0.3);
      }
    }

    .music-pill.music-on .music-icon {
      color: var(--accent);
    }

    .music-pill.music-on .music-bar:nth-child(1) {
      height: 6px;
    }
    .music-pill.music-on .music-bar:nth-child(2) {
      height: 11px;
    }
    .music-pill.music-on .music-bar:nth-child(3) {
      height: 8px;
    }

    .music-pill.music-off {
      background: rgba(10, 12, 18, 0.6);
      box-shadow: none;
      opacity: 0.7;
    }

    .music-pill.music-off .music-icon {
      color: rgba(200, 200, 200, 0.7);
    }

    .music-pill.music-off .music-bar {
      height: 3px;
      opacity: 0.5;
      background: rgba(180, 180, 180, 0.5);
    }

    .music-hint {
      font-size: 9px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(245, 230, 184, 0.9);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .music-pill.music-off .music-hint {
      opacity: 1;
      animation: hint-pulse 3s ease-in-out infinite;
    }

    @keyframes hint-pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .tune-button {
      flex: 1;
      padding: 12px 18px;
      border-radius: 999px;
      border: 1px solid var(--button-border);
      background: radial-gradient(
        circle at top left,
        #262a3f 0,
        var(--button-bg) 60%
      );
      color: var(--text-main);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .tune-button::after {
      content: "";
      position: absolute;
      top: 0;
      left: -40%;
      width: 40%;
      height: 100%;
      background: linear-gradient(
        120deg,
        rgba(245, 230, 184, 0.35),
        transparent
      );
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }

    .tune-button:hover::after {
      transform: translateX(180%);
    }

    .tune-button-label {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .tune-button-ring {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 1px solid rgba(245, 230, 184, 0.6);
      pointer-events: none;
      opacity: 0;
    }

    .tune-button.tune-active .tune-button-ring {
      animation: tune-ring 0.6s ease-out;
    }

    @keyframes tune-ring {
      0% {
        opacity: 0.7;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(1.08);
      }
    }

    .hint {
      font-size: 12px;
      color: var(--text-soft);
      opacity: 0.9;
      margin-top: 2px;
    }

    .hint strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    .last-played {
      margin-top: 8px;
      font-size: 13px;
    }

    .last-played span {
      color: var(--accent);
      font-weight: 500;
    }

    /* HOW TO TAB */
    .section-block {
      margin-top: 6px;
    }

    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .section-text {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.7;
      margin-bottom: 10px;
      max-width: 380px;
    }

    .section-text em {
      color: var(--accent-soft);
      font-style: normal;
      font-weight: 600;
    }

    .map-card {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 7, 10, 0.82);
      overflow: hidden;
    }

    .map-card-header {
      padding: 8px 10px 4px;
      font-size: 12px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .map-card-header span.left {
      font-weight: 500;
      color: var(--accent-soft);
    }

    .map-card-header span.right {
      font-size: 11px;
      opacity: 0.7;
    }

    .map-frame {
      width: 100%;
      height: 180px;
      overflow: hidden;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .map-frame iframe {
      width: 100%;
      height: 100%;
      border: 0;
    }

    .map-caption {
      padding: 6px 10px 8px;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    /* BOARD TAB */
    .board-wrapper {
      margin-top: 4px;
    }

    .board-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.6;
      max-width: 360px;
      margin-top: 6px;
    }

    .board-images {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .board-placeholder {
      border-radius: 14px;
      border: 1px dashed var(--placeholder-border);
      background: var(--placeholder-bg);
      padding: 8px 10px;
      font-size: 11px;
      color: var(--text-soft);
      min-height: 80px;
    }

    .board-placeholder-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-soft);
      margin-bottom: 3px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .board-list {
      margin-top: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(5, 7, 10, 0.9);
      padding: 10px 10px 6px;
    }

    .board-list-title {
      font-size: 12px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 6px;
    }

    .board-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
    }

    .board-item:last-child {
      border-bottom: none;
    }

    .board-poster-label {
      font-size: 12px;
      color: var(--text-main);
    }

    .board-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .qr-box {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 1px solid rgba(245, 230, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--accent-soft);
    }

    .like-chip {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(245, 230, 184, 0.6);
      font-size: 10px;
      color: var(--accent-soft);
    }

    .footer {
      font-size: 11px;
      color: rgba(167, 165, 160, 0.85);
      text-align: right;
      margin-top: 14px;
    }

    .footer span.test {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent);
      margin-right: 6px;
    }

    .footer .credit {
      font-size: 10px;
      color: #a19d93;
      text-align: left;
      margin-top: 4px;
    }

    @media (max-width: 400px) {
      .title {
        font-size: 22px;
      }
      .hero-image-box img {
        height: 120px;
      }
      .map-frame {
        height: 160px;
      }
      .pre-visual {
        width: 190px;
        height: 190px;
      }
    }
  </style>
</head>
<body>
  <!-- -1Ïû•: Pre-intro -->
  <div class="screen preintro-screen" id="screenMinus1">
    <div class="preintro-video-wrap">
      <video
        id="preIntroVideo"
        autoplay
        muted
        playsinline
      >
        <source src="media/preintro_glass_fog.mp4" type="video/mp4" />
      </video>

      <div class="preintro-dark" id="preIntroDark"></div>
      <div class="preintro-hair"></div>

      <div class="preintro-touch-layer" id="preIntroTouch"></div>

      <div class="preintro-popup-wrap">
        <div class="preintro-popup" id="preIntroPopup">
          <div class="preintro-popup-title">Brush the screen once</div>
          <div class="preintro-popup-body">
            Let your fingers arrive first. The city and the music
            will follow a moment later.
          </div>
          <div class="preintro-popup-hint">
            No surprises, just strings and a distant square.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 0Ïû•: Prelude -->
  <div class="screen prelude-screen hidden" id="screen0">
    <div class="pre-screen">
      <div class="pre-title">Prelude</div>
      <p class="pre-sub">
        This invitation is <strong>made for headphones</strong>.<br />
        Short sounds, a single tuning note and the city around you will blend
        together. To do that, we need a little permission to speak.
      </p>

      <div class="pre-visual">
        <div class="pre-wave-ring"></div>
        <div class="pre-wave-ring second"></div>
        <div class="pre-icon-card">
          <div class="pre-icon-phone">
            <div class="pre-icon-dot"></div>
            <div class="pre-icon-speaker">üîä</div>
            <div class="pre-icon-waves">
              <div class="pre-wave-line"></div>
              <div class="pre-wave-line"></div>
              <div class="pre-wave-line"></div>
            </div>
          </div>
          <div class="pre-label">sound on</div>
        </div>
      </div>

      <div class="pre-buttons">
        <button id="enterWithSound" class="pre-btn-main">
          Enter with music
        </button>
        <button id="enterSilent" class="pre-btn-ghost">
          enter silently ¬∑ I‚Äôll turn it on later
        </button>
      </div>

      <p class="pre-caption-small">
        Your browser may ask you to allow audio the first time.<br />
        There will be no sudden shouting, just tuning, ambience and a few
        whispered instructions.
      </p>
    </div>
  </div>

  <!-- 1Ïû•: Î©îÏù∏ Ïï± -->
  <div class="screen main-screen hidden" id="screen1">
    <div class="app">
      <!-- Î®∏Î¶¨Ïπ¥ÎùΩ Ïò§Î≤ÑÎ†àÏù¥ -->
      <div class="hair-overlay" id="hairOverlay"></div>

      <!-- ÏÉÅÎã® ÌÉ≠ -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="invitation">Invitation</button>
        <button class="tab-btn" data-tab="howto">How to start</button>
        <button class="tab-btn" data-tab="board">Board</button>
      </div>

      <main>
        <!-- TAB 1: Invitation -->
        <section id="tab-invitation" class="tab-panel active">
          <div>
            <h1 class="title">
              <span class="accent">Invitation</span>
              A small moment in
              <span class="highlight-word">Frankfurt</span>,<br />
              tuned in <span class="highlight-letter">A</span>.
            </h1>

            <!-- HERO IMAGE + Apple-style caption slider -->
            <div class="hero-image-box">
              <img src="picture/AlteOper.png" alt="Frankfurt Alte Oper at night" />
              <div class="hero-caption">
                <div class="hero-caption-slide active" data-index="0">
                  <div class="hero-caption-primary">
                    Cinematic night view of Frankfurt Alte Oper
                  </div>
                  <div class="hero-caption-body">
                    Warm streetlights, a slightly blurred square, and the feeling
                    that something is quietly tuning itself before it begins.
                  </div>
                </div>

                <div class="hero-caption-slide" data-index="1">
                  <div class="hero-caption-body">
                    Saturday, 14 June 2025 ¬∑ 19:30<br />
                    Samstag, 14. Juni 2025 ¬∑ 19:30 Uhr<br /><br />
                    <strong>Start:</strong> Alte Oper, Frankfurt ‚Äì the final location
                    will be revealed on site, not on this screen.<br /><br />
                    A small moment in Frankfurt, tuned in A. Wear your headphones and
                    let tonight be one long tuning note before anything else starts.
                  </div>
                  <div class="hero-caption-meta">
                    TEST MODE ¬∑ Background layer: ‚ÄúSerenade For Strings Op.48 ¬∑ 2nd movt‚Äù.
                    It grows with you from the fogged glass to the square, then bows a little
                    whenever your own A begins to ring.
                  </div>
                </div>

                <div class="hero-caption-dots">
                  <div class="hero-dot active" data-index="0"></div>
                  <div class="hero-dot" data-index="1"></div>
                </div>
              </div>
            </div>

            <!-- TUNE SECTION -->
            <section class="tune-section">
              <div class="tune-header-row">
                <div class="tune-title">Orchestra warm-up</div>
                <div class="instrument-pill">
                  <span class="instrument-pill-label">You are</span>
                  <span class="instrument-name" id="instrumentLabel">Violins II</span>
                </div>
              </div>

              <div class="tune-row">
                <button id="musicToggle" class="music-pill music-on" type="button">
                  <div class="music-pill-row">
                    <span class="music-icon">‚ô™</span>
                    <span class="music-meter">
                      <span class="music-bar"></span>
                      <span class="music-bar"></span>
                      <span class="music-bar"></span>
                    </span>
                  </div>
                  <span class="music-hint">Try &amp; enjoy the strings</span>
                </button>

                <button id="tuneButton" class="tune-button" type="button">
                  <span class="tune-button-label">Let A ring</span>
                  <div class="tune-button-ring"></div>
                </button>
              </div>

              <p class="hint">
                <strong>Test mode:</strong> every touch lets one random tuning moment
                ring out. Existing sounds are not stopped, so they overlap like a
                real orchestra getting ready.
              </p>
              <p class="last-played">
                Last played: <span id="lastPlayed">‚Äì nothing yet ‚Äì</span>
              </p>
            </section>

            <!-- ÏãúÍ∞Ñ/Ïû•ÏÜå Ïπ¥Îìú (Í∞ÑÎã® Î≤ÑÏ†Ñ Ïú†ÏßÄ) -->
            <div class="time-location-card">
              <p class="datetime">
                <span>Saturday, 14 June 2025 ¬∑ 19:30</span>
                <span>Samstag, 14. Juni 2025 ¬∑ 19:30 Uhr</span>
              </p>
              <p class="info-strip">
                <span>Start</span> Alte Oper, Frankfurt ¬∑ The final location will be
                revealed on site, not on this screen.
              </p>
            </div>

            <!-- Invitation text slider (Î≥∏Î¨∏) -->
            <div class="invitation-slider" id="invitationSlider">
              <div class="inv-slide active" data-index="0">
                <p class="subtitle">
                  A small moment in Frankfurt, tuned in <strong>A</strong>.<br />
                  Wear your headphones and let tonight be one long tuning note
                  before anything else starts.
                </p>
              </div>

              <div class="inv-slide" data-index="1">
                <p class="subtitle">
                  We meet in front of Alte Oper, but the final destination is
                  <strong>not written here</strong>.<br />
                  The city, the people around you and this page will quietly
                  reveal it on the way.
                </p>
              </div>

              <div class="inv-slide" data-index="2">
                <p class="subtitle">
                  When the square feels like it is breathing together ‚Äì traffic,
                  footsteps, voices drifting in one direction ‚Äì<br />
                  let the music icon glow and tap <strong>‚ÄúLet A ring‚Äù</strong> once.
                </p>
              </div>

              <div class="inv-pagination" aria-label="Invitation text slides">
                <button
                  class="inv-dot active"
                  type="button"
                  data-index="0"
                  aria-label="Slide 1"
                ></button>
                <button
                  class="inv-dot"
                  type="button"
                  data-index="1"
                  aria-label="Slide 2"
                ></button>
                <button
                  class="inv-dot"
                  type="button"
                  data-index="2"
                  aria-label="Slide 3"
                ></button>
              </div>
            </div>
          </div>
        </section>

        <!-- TAB 2: How to start -->
        <section id="tab-howto" class="tab-panel">
          <div>
            <h1 class="title">
              <span class="accent">How to start</span>
              Alte Oper ¬∑ warm-up instructions
            </h1>
          </div>

          <section class="section-block">
            <div class="section-title">English</div>
            <p class="section-text">
              When you step onto the square in front of Alte Oper, don‚Äôt rush.
              Let the traffic, the footsteps and the small conversations move
              around you for a moment. Imagine the whole place breathing in and
              out together, like a slow tide you happen to stand inside.
            </p>
            <p class="section-text">
              At some point you will feel that everything is drifting in one
              direction ‚Äì a quiet current under the noise. That is your moment.
              Open this page, put on your headphones, let the music icon glow,
              and let <em>A</em> ring once.
            </p>
            <p class="section-text">
              You don‚Äôt have to force anything. Just follow the tiny shifts:
              who arrives, who leaves, which light turns on, which sound suddenly
              feels closer. The rest of the evening will unfold from there, almost
              as if the square had already decided it for you.
            </p>
          </section>

          <section class="section-block">
            <div class="section-title">Deutsch</div>
            <p class="section-text">
              Wenn du auf den Opernplatz vor der Alten Oper trittst, beeile dich
              nicht. Lass f√ºr einen Moment Verkehr, Schritte und Gespr√§che um dich
              herum weiterlaufen. Stell dir vor, der ganze Platz atmet gemeinsam
              ein und aus ‚Äì wie eine langsame Welle, in der du einfach stehst.
            </p>
            <p class="section-text">
              Irgendwann sp√ºrst du, dass alles leicht in eine Richtung treibt ‚Äì
              ein leiser Strom unter dem Ger√§usch. Das ist dein Moment. √ñffne
              diese Seite, setz deine Kopfh√∂rer auf, lass das Musik-Symbol
              leuchten und lass einmal ein <em>A</em> klingen.
            </p>
            <p class="section-text">
              Du musst nichts erzwingen. Folge nur den kleinen Verschiebungen:
              wer ankommt, wer geht, welches Licht angeht, welcher Klang pl√∂tzlich
              n√§her wirkt. Der Rest des Abends entfaltet sich von dort, fast so,
              als h√§tte der Platz l√§ngst beschlossen, wie er mit dir spielt.
            </p>
          </section>

          <section class="map-card">
            <div class="map-card-header">
              <span class="left">Alte Oper ¬∑ Map preview</span>
              <span class="right">Google Maps embed</span>
            </div>
            <div class="map-frame">
              <iframe
                src="https://www.google.com/maps?q=Alte+Oper+Frankfurt&output=embed"
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
              ></iframe>
            </div>
            <p class="map-caption">
              This map is just a quiet anchor. On the night itself, the real line
              you follow is the flow of people, light and sound on the square.
              Die Karte ist nur ein leiser Anker. Am Abend selbst folgst du vor
              allem dem Fluss von Menschen, Licht und Klang auf dem Platz.
            </p>
          </section>
        </section>

        <!-- TAB 3: Board -->
        <section id="tab-board" class="tab-panel">
          <div class="board-wrapper">
            <h1 class="title">
              <span class="accent">Board</span>
              Posters, QR codes & tiny victories
            </h1>
            <p class="board-subtitle">
              Imagine a wall where every small poster belongs to someone who was
              here tonight. Some get scanned, some get ignored, some collect more
              silent <span class="highlight-word">likes</span> than they expected.
            </p>

            <div class="board-images">
              <div class="board-placeholder">
                <div class="board-placeholder-title">
                  POSTER BOARD IMAGE
                </div>
                Moody wooden or cork notice board under warm indoor light,
                layers of torn paper, tiny empty spaces where QR codes and
                names will live.
              </div>
              <div class="board-placeholder">
                <div class="board-placeholder-title">
                  SUBWAY WALL IMAGE
                </div>
                Night-time metro station wall with overlapping posters, tape,
                and soft fluorescent light ‚Äì like an urban gallery for QR codes.
              </div>
            </div>

            <div class="board-list">
              <div class="board-list-title">
                tonight‚Äôs wall ¬∑ draft layout
              </div>

              <div class="board-item">
                <div class="board-poster-label">
                  ‚ÄúStreetlight duet‚Äù ¬∑ poster #07
                </div>
                <div class="board-meta">
                  <div class="qr-box">QR</div>
                  <div class="like-chip">23 likes</div>
                </div>
              </div>

              <div class="board-item">
                <div class="board-poster-label">
                  ‚ÄúSilent violin II‚Äù ¬∑ poster #12
                </div>
                <div class="board-meta">
                  <div class="qr-box">QR</div>
                  <div class="like-chip">15 likes</div>
                </div>
              </div>

              <div class="board-item">
                <div class="board-poster-label">
                  ‚ÄúTimpani in the metro‚Äù ¬∑ poster #03
                </div>
                <div class="board-meta">
                  <div class="qr-box">QR</div>
                  <div class="like-chip">31 likes</div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <div class="footer">
        <span class="test">PROTOTYPE</span>
        Sean‚Äôs party ¬∑ tuned in A.
        <div class="credit">
          Built as a small hyperlocal score for Alte Oper ¬∑ background strings,
          one tuning note and a few quiet instructions.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------------------
    // Audio: background
    // ---------------------
    let bgAudio = null;
    let bgLogicalVolume = 0.0; // 0‚Äì1
    let bgMuted = false;
    let bgFadeId = null;

    function ensureBgAudio() {
      if (!bgAudio) {
        bgAudio = new Audio("media/Serenade For Strings Op.48_2nd movt.wav");
        bgAudio.loop = true;
        bgAudio.volume = 0;
      }
      return bgAudio;
    }

    function updateBgOutputVolume() {
      if (!bgAudio) return;
      bgAudio.volume = bgMuted ? 0 : bgLogicalVolume;
    }

    function fadeBgVolume(target, durationMs) {
      const audio = ensureBgAudio();
      if (!audio) return;
      if (bgFadeId) cancelAnimationFrame(bgFadeId);

      const start = bgLogicalVolume;
      const diff = target - start;
      const startTime = performance.now();

      function step(now) {
        const t = Math.min(1, (now - startTime) / durationMs);
        bgLogicalVolume = start + diff * t;
        if (bgLogicalVolume < 0) bgLogicalVolume = 0;
        if (bgLogicalVolume > 1) bgLogicalVolume = 1;
        updateBgOutputVolume();
        if (t < 1) {
          bgFadeId = requestAnimationFrame(step);
        }
      }

      bgFadeId = requestAnimationFrame(step);
    }

    function startBgPlaybackIfNeeded() {
      const audio = ensureBgAudio();
      audio
        .play()
        .then(() => {
          updateBgOutputVolume();
        })
        .catch((err) => {
          console.warn("Background audio autoplay blocked:", err);
        });
    }

    function setMusicMuted(m) {
      bgMuted = m;
      updateBgOutputVolume();
      const musicToggle = document.getElementById("musicToggle");
      if (!musicToggle) return;
      musicToggle.classList.toggle("music-off", m);
      musicToggle.classList.toggle("music-on", !m);
    }

    // ---------------------
    // Audio: timpani click (only -1, 0Ïû•)
    // ---------------------
    function playTimpaniClick() {
      try {
        const timp = new Audio("media/TS_IFD_kick_timpani_heavy.wav");
        timp.volume = 0.6;
        timp.play().catch(() => {});
      } catch (e) {
        console.warn("Timpani click failed:", e);
      }
    }

    // ---------------------
    // Audio: tuning samples (1Ïû• Ï†ÑÏö©)
    // ---------------------
    const tuningSamples = [
      {
        src: "media/SI_Cac_fx_cellos_tuning_one_shot_imaginative.wav",
        label: "Cellos ¬∑ imaginative",
        role: "Cellos"
      },
      {
        src: "media/SI_Cac_fx_trumpets_tuning_one_shot_growing.wav",
        label: "Trumpets ¬∑ growing",
        role: "Trumpets"
      },
      {
        src: "media/SI_Cac_fx_violins_tuning_one_shot_blooming.wav",
        label: "Violins ¬∑ blooming",
        role: "Violins II"
      },
      {
        src: "media/zoid_percussion_timpani_roll_A.wav",
        label: "Timpani roll ¬∑ A",
        role: "Timpani"
      }
    ];

    const instrumentRoles = [
      { id: "cellos", display: "Cellos" },
      { id: "trumpets", display: "Trumpets" },
      { id: "violins2", display: "Violins II" },
      { id: "timpani", display: "Timpani" }
    ];

    function getAssignedInstrument() {
      const key = "partyInstrumentRole_v1";
      try {
        const saved = localStorage.getItem(key);
        if (saved) {
          const found = instrumentRoles.find((r) => r.id === saved);
          if (found) return found;
        }
      } catch (_) {}
      const idx = Math.floor(Math.random() * instrumentRoles.length);
      const chosen = instrumentRoles[idx];
      try {
        localStorage.setItem(key, chosen.id);
      } catch (_) {}
      return chosen;
    }

    // ---------------------
    // Screen handling
    // ---------------------
    const screenMinus1 = document.getElementById("screenMinus1");
    const screen0 = document.getElementById("screen0");
    const screen1 = document.getElementById("screen1");

    const preIntroTouch = document.getElementById("preIntroTouch");
    const preIntroDark = document.getElementById("preIntroDark");
    const preIntroPopup = document.getElementById("preIntroPopup");
    const preIntroVideo = document.getElementById("preIntroVideo");

    const enterWithSoundBtn = document.getElementById("enterWithSound");
    const enterSilentBtn = document.getElementById("enterSilent");

    const hairOverlay = document.getElementById("hairOverlay");
    const tuneButton = document.getElementById("tuneButton");
    const lastPlayedEl = document.getElementById("lastPlayed");
    const musicToggle = document.getElementById("musicToggle");
    const instrumentLabelEl = document.getElementById("instrumentLabel");
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabPanels = {
      invitation: document.getElementById("tab-invitation"),
      howto: document.getElementById("tab-howto"),
      board: document.getElementById("tab-board")
    };

    const assignedInstrument = getAssignedInstrument();
    if (instrumentLabelEl && assignedInstrument) {
      instrumentLabelEl.textContent = assignedInstrument.display;
    }

    // 1Ïû• Î®∏Î¶¨Ïπ¥ÎùΩ Ïì∏Ïñ¥ÎÇ¥Í∏∞
    if (hairOverlay) {
      hairOverlay.addEventListener("click", () => {
        hairOverlay.classList.add("hair-gone");
      });
    }

    // -1Ïû• ‚Üí 0Ïû•
    let preIntroStarted = false;
    function handlePreIntro() {
      if (preIntroStarted) return;
      preIntroStarted = true;

      playTimpaniClick(); // -1Ïû• ÌÅ¥Î¶≠ ÏÇ¨Ïö¥Îìú
      startBgPlaybackIfNeeded();
      fadeBgVolume(0.3, 10000); // 0 ‚Üí 30% over 10s

      if (preIntroDark) {
        preIntroDark.style.opacity = "0";
      }

      if (preIntroPopup) {
        preIntroPopup.classList.add("preintro-popup-fade-out");
      }

      if (preIntroVideo) {
        preIntroVideo.muted = false;
      }

      setTimeout(() => {
        if (screenMinus1) {
          screenMinus1.classList.add("preintro-fade-out");
          setTimeout(() => {
            screenMinus1.classList.add("hidden");
            if (screen0) screen0.classList.remove("hidden");
          }, 600);
        } else {
          if (screen0) screen0.classList.remove("hidden");
        }
      }, 2000);
    }

    if (preIntroTouch) {
      preIntroTouch.addEventListener("click", handlePreIntro);
    }
    if (preIntroPopup) {
      preIntroPopup.addEventListener("click", handlePreIntro);
    }

    // 0Ïû• ‚Üí 1Ïû•
    function enterApp(withSound) {
      // ÌÖúÌååÎãà ÌÅ¥Î¶≠ÏùÄ 0Ïû•ÏóêÏÑúÎßå
      playTimpaniClick();

      if (screen0) screen0.classList.add("hidden");
      if (screen1) screen1.classList.remove("hidden");

      if (withSound) {
        // ÏùåÏïÖ Ïº† ÏÉÅÌÉúÎ°ú ÏßÑÏûÖ: 30% ‚Üí 5%Î°ú 10Ï¥à ÌéòÏù¥Îìú
        bgMuted = false;
        fadeBgVolume(0.05, 10000);
        setMusicMuted(false);
      } else {
        // Ï°∞Ïö©Ìûà ÏßÑÏûÖ: ÎÖºÎ¶¨ Î≥ºÎ•®ÏùÄ 5%Î°ú ÎßûÏ∂îÍ≥†, ÎÆ§Ìä∏ ÏÉÅÌÉú Ïú†ÏßÄ
        bgLogicalVolume = 0.05;
        setMusicMuted(true);
      }
    }

    if (enterWithSoundBtn) {
      enterWithSoundBtn.addEventListener("click", () => enterApp(true));
    }
    if (enterSilentBtn) {
      enterSilentBtn.addEventListener("click", () => enterApp(false));
    }

    // 1Ïû•: Music toggle (Î∞∞Í≤ΩÏùåÎßå Ï†úÏñ¥)
    if (musicToggle) {
      musicToggle.addEventListener("click", () => {
        setMusicMuted(!bgMuted);
      });
    }

    // 1Ïû•: ÌäúÎãù Î≤ÑÌäº
    function playRandomSample() {
      const idx = Math.floor(Math.random() * tuningSamples.length);
      const { src, label } = tuningSamples[idx];

      const audio = new Audio(src);
      audio.volume = 0.8;

      if (tuneButton) {
        tuneButton.classList.add("tune-active");
        setTimeout(() => {
          tuneButton.classList.remove("tune-active");
        }, 650);
      }

      audio
        .play()
        .then(() => {
          if (lastPlayedEl) lastPlayedEl.textContent = label;
        })
        .catch((err) => {
          console.error("Playback failed:", err);
          if (lastPlayedEl) lastPlayedEl.textContent = "Playback error";
        });
    }

    if (tuneButton) {
      tuneButton.addEventListener("click", playRandomSample);
    }

    // ÌÉ≠ Ï†ÑÌôò
    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tabKey = btn.getAttribute("data-tab");
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        Object.keys(tabPanels).forEach((key) => {
          tabPanels[key].classList.toggle("active", key === tabKey);
        });
      });
    });

    // Invitation tab ¬∑ text slider (Î≥∏Î¨∏)
    (function initInvitationSlider() {
      const slides = document.querySelectorAll(".invitation-slider .inv-slide");
      const dots = document.querySelectorAll(".invitation-slider .inv-dot");

      if (!slides.length || !dots.length) return;

      let current = 0;
      let timer = null;
      let userInteracted = false;

      function setSlide(index) {
        current = index;
        slides.forEach((slide, i) => {
          slide.classList.toggle("active", i === index);
        });
        dots.forEach((dot, i) => {
          dot.classList.toggle("active", i === index);
        });
      }

      function nextSlide() {
        const next = (current + 1) % slides.length;
        setSlide(next);
      }

      function startAuto() {
        if (userInteracted) return;
        if (timer) clearInterval(timer);
        timer = setInterval(nextSlide, 5000);
      }

      dots.forEach((dot) => {
        dot.addEventListener("click", () => {
          const index = parseInt(dot.getAttribute("data-index"), 10);
          if (!Number.isNaN(index)) {
            userInteracted = true;
            if (timer) clearInterval(timer);
            setSlide(index);
          }
        });
      });

      setSlide(0);
      startAuto();
    })();

    // Hero caption slider (Alte Oper Î∞ïÏä§ Ïïà)
    (function initHeroSlider() {
      const slides = document.querySelectorAll(".hero-caption-slide");
      const dots = document.querySelectorAll(".hero-dot");
      if (!slides.length) return;

      let current = 0;
      const durations = [7000, 14000]; // slide 0: 7s, slide 1: 14s

      function showSlide(i) {
        current = i;
        slides.forEach((s, idx) => {
          s.classList.toggle("active", idx === i);
        });
        dots.forEach((d, idx) => {
          d.classList.toggle("active", idx === i);
        });
      }

      function scheduleNext() {
        const dur = durations[current] || 10000;
        setTimeout(() => {
          const next = (current + 1) % slides.length;
          showSlide(next);
          scheduleNext();
        }, dur);
      }

      dots.forEach((dot) => {
        dot.addEventListener("click", () => {
          const idx = parseInt(dot.getAttribute("data-index"), 10);
          if (!Number.isNaN(idx)) {
            showSlide(idx);
          }
        });
      });

      showSlide(0);
      scheduleNext();
    })();
  </script>
</body>
</html>

